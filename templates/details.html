{% extends "base.html" %}
{% block title %}Incident Details{% endblock %}

{% block content %}
<h2 class="mb-4">Incident: {{ incident.title }}</h2>

<div class="card mb-4">
  <div class="card-body">
    <p><strong>Description:</strong> {{ incident.description }}</p>
    <p><strong>Status:</strong> {{ incident.status }}</p>
    <p><strong>Priority:</strong> {{ incident.priority }}</p>
    <p><strong>Operator:</strong> {{ incident.operator }}</p>
    <p><strong>Type:</strong> {{ incident.type }}</p>
    <p><strong>Work Duration:</strong> {{ incident.work_duration }}</p>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header">Update Incident</div>
  <div class="card-body">
    <form action="{{ url_for('update_incident', unique_id=incident.unique_id) }}" method="post">
      <div class="row g-3">
        <div class="col-md-4">
          <label for="status" class="form-label">New Status</label>
          <select id="status" name="status" class="form-select">
            {% for s in ['Open','In Progress','On Hold','Resolved','Closed'] %}
              <option value="{{s}}" {% if incident.status==s %}selected{% endif %}>{{s}}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4">
          <label for="operator" class="form-label">New Operator</label>
          <input type="text" id="operator" name="operator" value="{{ incident.operator }}" class="form-control" required>
        </div>
      </div>
      <div class="mt-3">
        <label for="description" class="form-label">New Description</label>
        <textarea id="description" name="description" class="form-control">{{ incident.description }}</textarea>
      </div>
      <div class="mt-4 text-end">
        <button type="submit" class="btn btn-primary">Update</button>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-header">Update History</div>
  <ul class="list-group list-group-flush">
    {% for update in incident.history %}
    <li class="list-group-item">
      <strong>{{ update.timestamp }}</strong> – {{ update.status }} –
      <em>{{ update.operator }}</em><br>
      {{ update.description }}
    </li>
    {% endfor %}
  </ul>
</div>

<div class="mt-4">
  <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to list</a>
</div>
{% endblock %}